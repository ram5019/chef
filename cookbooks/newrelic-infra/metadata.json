{
  "name": "newrelic-infra",
  "description": "Installs/Configures the New Relic Infrastructure agent and on-host integrations",
  "long_description": "# newrelic-infra Cookbook\n\n[![Travis CI Build Status](https://travis-ci.org/newrelic/infrastructure-agent-chef.svg?branch=master)](https://travis-ci.org/newrelic/infrastructure-agent-chef) [![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/newrelic/infrastructure-agent-chef?svg=true)](https://ci.appveyor.com/project/smith37586/infrastructure-agent-chef) [![Chef Supermarket Cookbook](https://img.shields.io/cookbook/v/newrelic-infra.svg)](https://supermarket.chef.io/cookbooks/newrelic-infra)\n\nThis cookbook installs and configures the New Relic Infrastructure agent as well as new Relic provided and custom on-host integrations for the Infrastructure agent can be installed.\nSee the [CHANGELOG][11] for information on the latest changes.\n\n## Requirements\n\n### Platforms\n\n* Amazon Linux all versions\n* CentOS version 6 or higher\n* Debian version 7 (\"Wheezy\") or higher\n* Red Hat Enterprise Linux (RHEL) version 6 or higher\n* Ubuntu versions 12.04.*, 14.04.*, and 16.04.* (LTS versions)\n* Windows Server 2008, 2012, and 2016 and their service packs.\n\n### Chef\n\n- Chef 12.15+\n\n### Cookbooks\n\n- [poise-service][1]\n- [poise-archive][2]\n\n## Recipes\n\n### `newrelic-infra::default`\n\nDetermines the platform and includes the appropriate platform specific recipe.\nThis is the only recipe that should be included in a node's run list.\n\n### `newrelic-infra::agent_linux`\n\nInstalls and configures the Infrastructure agent on a Linux host.\nThis recipe should _NOT_ be directly included in a node's run list.\nThe default recipe will automatically determine which platform specific recipe to apply.\n\n1. Adds the `newrelic-infra` package repository source\n2. Can install, upgrade, or remove the `newrelic-infra` package. By default, the package is only installed.\n3. Enables and starts the `newrelic_infra` agent service\n4. Generates the agent configuration file\n5. Includes the `newrelic-infra::host_integrations` recipe to install and configure any on-host integrations\n\n### `newrelic-infra::agent_windows`\n\nInstalls and configures the Infrastructure agent on a Windows host.\nThis recipe should _NOT_ be directly included in a node's run list.\nThe default recipe will automatically determine which platform specific recipe to apply.\n\n### `newrelic-infra::host_integrations`\n\nInstalls New Relic provided and custom on-host integrations if the associated feature flag is enabled (i.e., `default['newrelic_infra']['features]['host_integrations']`).\nGenerates configuration for any of the available on-host integrations from New Relic.\nInstalls any custom integrations defined with attributes.\nFor more infromation on the available custom resource for installing and configuring custom on-host integrations see the [Custom resources][9] documentation.\n\nExample configuration for a custom on-host integration installed and configured via attributes:\n\n```ruby\ndefault['newrelic_infra']['custom_integrations']['test_integration'] = {\n  integration_name: 'com.test.integration',\n  remote_url: 'https://url-to-a-tarball-for-install.com/test.tar.gz',\n  instances: [\n    {\n      name: 'test_integration_metrics',\n      command: 'metrics',\n      arguments: {\n        test: true\n      },\n      labels: {\n        environment: 'test'\n      }\n    }\n  ],\n  commands: {\n    metrics: %w[--metrics]\n  }\n}\n```\n\nFor more information on the available New Relic on-host integrations and configuration see:\n\n1. [Cassandra][6]\n2. [MySQL][7]\n3. [Nginx][8]\n\n## Attributes\n\nSee [attributes/defaults.rb][3] for more details and default values.\n\n| Name | Default value | Description |\n|:-----|:--------------|:------------|\n| `default['newrelic_infra']['features']['manage_service_account']` | `true` | Manage a local service account for running the agent |\n| `default['newrelic_infra']['features']['host_integrations']` | `false` | Install New Relic on-host integrations |\n| `default['newrelic_infra']['user']['name']` | `newrelic_infra` | Service account user name |\n| `default['newrelic_infra']['group']['name']` | `newrelic_infra` | Service account group name |\n| `default['newrelic_infra']['config']['license_key']` | `nil` | Account license key to send metrics to |\n| `default['newrelic_infra']['config']['display_name']` | `nil` | Override the auto-generated hostname for reporting |\n| `default['newrelic_infra']['config']['proxy']` | `nil` | Use a proxy to communicate with New Relic |\n| `default['newrelic_infra']['config']['verbose']` | `nil` | When set to 1, enables verbose logging for the agent |\n| `default['newrelic_infra']['config']['debug']` | `nil` | Enable Golang debugging |\n| `default['newrelic_infra']['config']['log_file']` | `nil` | To log to another location; when not set, the agent logs to the system log files |\n| `default['newrelic_infra']['config']['custom_attributes']` | `{}` | A hash of custom attributes to annotate the data from this agent instance |\n| `default['newrelic_infra']['agent']['config']['file']` | `agent.yaml` | File name for the agent configuration |\n| `default['newrelic_infra']['agent']['config']['mode']` | `0640` | File permissions for the agent configuration |\n| `default['newrelic_infra']['agent']['directory']['path']` | `/etc/newrelic-infra` | Directory path for the agent configuration |\n| `default['newrelic_infra']['agent']['directory']['mode']` | `0750` | Directory permissions for the agent configuration |\n| `default['newrelic_infra']['packages']['agent']['action']` | `[:install]` | Action(s) to perform on the agent package |\n| `default['newrelic_infra']['packages']['agent']['retries']` | `0` | The number of times to catch exceptions and retry the resource |\n| `default['newrelic_infra']['packages']['agent']['version']` | `nil` | Version of the agent package to install |\n| `default['newrelic_infra']['packages']['host_integrations']['action']` | `[:install]` | Action(s) to perform on the agent on-host integrations package |\n| `default['newrelic_infra']['packages']['host_integrations']['retries']` | `0` | The number of times to catch exceptions and retry the resource |\n| `default['newrelic_infra']['packages']['host_integrations']['version']` | `nil` | Version of the on-host integrations package to install |\n| `default['newrelic_infra']['host_integrations']['config_dir']` | `/etc/newrelic-infra/integrations.d` | Directory for the New Relic provided on-host integration configurations |\n| `default['newrelic_infra']['host_integrations']['config']` | `{}` | New Relic provided on-host integration configuration |\n| `default['newrelic_infra']['custom_integrations']` | `{}` | New Relic Infrastructure on-host custom integration configuration |\n\n### APT repository attributes\n\nThe `apt_repository` Chef resource is built using metaprogramming, so that the configuration can be extended via attributes.\nAny property available to the resource can be passed in via attributes.\nAttributes that cannot be passed to the resource are logged out as warnings in order to prevent potential failes from typos, older Chef versions, etc.\nFor more information, refer to the Chef documentation on the [apt_repository][4] resource.\n\n| Name | Default value | Description |\n|:-----|:--------------|:------------|\n| `default['newrelic_infra']['apt']['uri']` | `https://download.newrelic.com/infrastructure_agent/linux/apt` | Repository base URL |\n| `default['newrelic_infra']['apt']['key']` | `https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg` | Repository GPG key URL |\n| `default['newrelic_infra']['apt']['distribution']` | `node['lsb']['codename']` | Distribution code name |\n| `default['newrelic_infra']['apt']['components']` | `['main']` | Repository components |\n| `default['newrelic_infra']['apt']['arch']` | `'amd64'` | Package architecture to install |\n| `default['newrelic_infra']['apt']['action']` | `[:add]` | `apt_repository` resource actions to perform |\n\n### Windows attributes\n\nWhen using Windows, you can set a source URL and checksum for the agent download.\n\n| Name | Default value | Description |\n|:-----|:--------------|:------------|\n| `default['newrelic-infra']['windows_source']` | `https://download.newrelic.com/infrastructure_agent/windows/newrelic-infra.msi` | Remote URL for Infrastructure agent windows download |\n| `default['newrelic-infra']['windows_checksum']` | `nil` | SHA-256 Checksum for source file |\n\n### Yum repository attributes\n\nThe `yum_repository` Chef resource is built using metaprogramming, so that the configuration can be extended via attributes.\nAny property available to the resource can be passed in via attributes.\nAttributes that cannot be passed to the resource are logged out as warnings in order to prevent potential failes from typos, older Chef versions, etc.\nFor more information, refer to the Chef documentation on the [yum_repository][5] resource.\n\n| Name | Default value | Description |\n|:-----|:--------------|:------------|\n| `default['newrelic_infra']['yum']['description']` | 'New Relic Infrastructure' | Repository description |\n| `default['newrelic_infra']['yum']['baseurl']` | Default is determined by distribution see [attributes/default.rb][3] for more information. | Repository base URL |\n| `default['newrelic_infra']['yum']['gpgkey']` | `'https://download.newrelic.com/infrastructure_agent/gpg/newrelic-infra.gpg'` | Repository GPG key URL |\n| `default['newrelic_infra']['yum']['gpgcheck']` | `true` | Perform a GPG check on installed packages |\n| `default['newrelic_infra']['yum']['repo_gpgcheck']` | `true` | Perform a GPG check on the package repository |\n| `default['newrelic_infra']['yum']['action']` | `[:add, :makecache]` | `yum_repository` resource actions to perform |\n\n## Custom Resources\n\n### `newrelic_infra_integration`\n\nInstalls and configures a custom New Relic Infrastructure on-host integration.\n\nExample:\n\n```ruby\nnewrelic_infra_integration 'test' do\n  integration_name 'test_integration'\n  remote_url 'https://url-to-a-tarball-for-install.com/test.tar.gz'\n  commands { metrics: %w[--metrics] }\n  instances(\n    [\n      {\n        name: 'test_integration_metrics',\n        command: 'metrics',\n        arguments: {\n          test: true\n        },\n        labels: {\n          environment: 'test'\n        }\n      }\n    ]\n  )\nend\n```\n\nSupported properties:\n\n| Property name | Required | Type | Default |\n|:--------------|:---------|:-----|:--------|\n| `integration_name` | `true` | String | nil |\n| `remote_url` | `true` | String | nil |\n| `instances` | `true` | Array | nil |\n| `commands` | `true` | Hash | nil |\n| `description` | `false` | [String, nil] | nil |\n| `cli_options` | `false` | [Hash, nil] | nil |\n| `interval` | `false` | Integer | 10 |\n| `prefix` | `false` | String | `integration/#{integration_name}` |\n| `install_method` | `true` | `'tarball'` or `'binary'` | 'tarball' |\n| `os` | `false` | `'linux'` | 'linux' |\n| `protocol_version` | `false` | Integer | 1 |\n| `user` | `false` | String | `'newrelic_infra'` |\n| `group` | `false` | String | `'newrelic_infra'` |\n| `base_dir` | `false` | String | `'/var/db/newrelic-infra/custom-integrations'` |\n| `bin_dir` | `false` | String | `/opt/newrelic-infra` |\n| `bin` | `false` | String | The folder is `#{bin_dir}/#{name}` and the file name is the tarball or binary without any extension |\n| `definition_file` | `false` | String | `#{base_dir}/#{resource_name).yaml` |\n| `config_dir` | `false` | String | '/etc/newrelic-infra/integrations.d/' |\n| `config_file` | `false` | String | `#{config_dir}/#{resource_name).yaml` |\n\n## Usage\n\n### Cookbook usage\n\n- Set any attributes necessary for your desired configuration\n- Add the `newrelic-infra::default` recipe your run list\n- For wrapper cookbooks, add the `newrelic-infra` cookbook as a dependency to your `metadata.rb` or `Berksfile`, then include `newrelic-infra::default` recipe.\n\n### Custom resource usage\n\n- Add the `newrelic-infra` cookbook as a dependency to your `metadata.rb` or `Berksfile`\n- Configure the custom resource(s) using the supported properties\n\n## Testing\n\nSee [CONTRIBUTING.md][10] for details on how to test and contribute to this cookbook.\n\nCopyright (c) 2016-2017 New Relic, Inc. All rights reserved.\n\n[1]:  https://github.com/poise/poise-service\n[2]:  https://github.com/poise/poise-archive\n[3]:  attributes/default.rb\n[4]:  https://docs.chef.io/resource_apt_repository.html\n[5]:  https://docs.chef.io/resource_yum_repository.html\n[6]:  https://docs.newrelic.com/docs/infrastructure/integrations/cassandra-integration-new-relic-infrastructure\n[7]:  https://docs.newrelic.com/docs/infrastructure/integrations/mysql-integration-new-relic-infrastructure\n[8]:  https://docs.newrelic.com/docs/infrastructure/integrations/nginx-integration-new-relic-infrastructure\n[9]:  #custom-resources\n[10]:  CONTRIBUTING.md\n[11]:  CHANGELOG.md\n",
  "maintainer": "New Relic, Inc",
  "maintainer_email": "",
  "license": "All rights reserved",
  "platforms": {
    "amazon": ">= 2013.0.0",
    "debian": ">= 7.0.0",
    "ubuntu": ">= 12.4.0",
    "redhat": ">= 6.0.0",
    "oracle": ">= 6.0.0",
    "centos": ">= 6.0.0",
    "suse": ">= 0.0.0",
    "windows": ">= 0.0.0"
  },
  "dependencies": {
    "poise-service": "~> 1.5",
    "poise-archive": "~> 1.5"
  },
  "recommendations": {
  },
  "suggestions": {
  },
  "conflicting": {
  },
  "providing": {
  },
  "replacing": {
  },
  "attributes": {
  },
  "groupings": {
  },
  "recipes": {
  },
  "version": "0.6.0",
  "source_url": "https://github.com/newrelic/infrastructure-agent-chef",
  "issues_url": "https://github.com/newrelic/infrastructure-agent-chef/issues",
  "privacy": false,
  "chef_versions": [
    [
      ">= 12.15"
    ]
  ],
  "ohai_versions": [

  ],
  "gems": [

  ]
}